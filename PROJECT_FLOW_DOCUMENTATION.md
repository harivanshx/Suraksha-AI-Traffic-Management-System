# AI Traffic Management System - Complete Project Documentation

## Table of Contents
1. [System Architecture](#system-architecture)
2. [Data Flow Diagrams](#data-flow-diagrams)
3. [User Interaction Flow](#user-interaction-flow)
4. [Traffic Analysis Flow](#traffic-analysis-flow)
5. [Chatbot Integration Flow](#chatbot-integration-flow)
6. [File Structure & Dependencies](#file-structure--dependencies)
7. [Database/Session Flow](#databasesession-flow)

---

## System Architecture

### High-Level Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT (Browser)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Landing.htmlâ”‚  â”‚  Index.html  â”‚  â”‚ Results.html â”‚           â”‚
â”‚  â”‚  (Welcome)   â”‚  â”‚  (Upload)    â”‚  â”‚  (Analysis)  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                â”‚                    â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                          â”‚                                       â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚              â”‚   main.js (Frontend)   â”‚                         â”‚
â”‚              â”‚ - File Upload          â”‚                         â”‚
â”‚              â”‚ - Session Management   â”‚                         â”‚
â”‚              â”‚ - Form Handling        â”‚                         â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                          â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    HTTP Requests (JSON)
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLASK BACKEND (app.py)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     Routes & Endpoints                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â”‚
â”‚  â”‚  â”‚  GET /      â”‚ â”‚ GET /      â”‚ â”‚ GET /       â”‚          â”‚  â”‚
â”‚  â”‚  â”‚ (Landing)   â”‚ â”‚ /traffic   â”‚ â”‚ /accident   â”‚          â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â”‚
â”‚  â”‚  â”‚ POST /upload â”‚ â”‚ POST /chat â”‚ â”‚ POST /       â”‚          â”‚  â”‚
â”‚  â”‚  â”‚  (Files)     â”‚ â”‚  (Chatbot) â”‚ â”‚ process      â”‚          â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
â”‚  â”‚         â”‚                â”‚             â”‚                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                â”‚             â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            Session Management (Flask Sessions)             â”‚  â”‚
â”‚  â”‚  - uploaded_files[direction] = filepath                    â”‚  â”‚
â”‚  â”‚  - processing_mode = 'video' or 'image'                    â”‚  â”‚
â”‚  â”‚  - session_id = unique identifier                          â”‚  â”‚
â”‚  â”‚  - results = analysis data                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Processing Layer (web_processor.py)            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚         WebTrafficProcessor Class                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - process_direction_video(filepath, direction)        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - process_direction_image(filepath, direction)        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - aggregate_results(direction_results)                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - save_annotated_frame(frame, output_path)            â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         ML/Traffic Analysis Layer (src/traffic_analyzer.py)  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚         TrafficAnalyzer Class                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - analyze_traffic(frame, direction)                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - detect_vehicles(frame)                              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - count_vehicles_by_type()                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - recommend_signal_timing()                           â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      Vehicle Detection Layer (src/vehicle_detector.py)       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚         VehicleDetector Class (YOLOv11n)               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - detect_vehicles(frame)                              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - Returns: detections with class & confidence         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  Classes: Car, Motorcycle, Bus, Truck                  â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        AI/Chatbot Integration (Google Gemini API)            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚    _build_traffic_context(traffic_data)                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â†“                                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    genai.GenerativeModel('gemini-pro')                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â†“                                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    AI Response (with traffic insights)                 â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    JSON Responses
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FILE SYSTEM                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  uploads/    â”‚  â”‚  models/     â”‚  â”‚  output/     â”‚           â”‚
â”‚  â”‚  â”œâ”€sessions/ â”‚  â”‚  (yolo11n.pt)â”‚  â”‚  (logs)      â”‚           â”‚
â”‚  â”‚  â”‚ â””â”€session1â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â”‚  â”‚   â”œâ”€north â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â”‚  â”‚   â”œâ”€south â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â”‚  â”‚   â”œâ”€east  â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â”‚  â”‚   â””â”€west  â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â”‚  â””â”€results/  â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â”‚    â””â”€session1â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â”‚      (frames)â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagrams

### 1. File Upload Flow

```
User clicks "Upload"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Drag & Drop / File Selection       â”‚
â”‚  (index.html)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Validate File Type  â”‚
        â”‚ - Check extension   â”‚
        â”‚ - Check file size   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ File Valid?     â”‚
         â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
           â”‚            â”‚
        YESâ”‚            â”‚NO
           â”‚            â–¼
           â”‚    Show Error Message
           â”‚    Return to upload
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ FormData({               â”‚
    â”‚   direction: 'NORTH',    â”‚
    â”‚   file: File Object      â”‚
    â”‚ })                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼ HTTP POST /upload
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Flask /upload Endpoint       â”‚
    â”‚  1. Get direction from form   â”‚
    â”‚  2. Get file from request     â”‚
    â”‚  3. Validate direction        â”‚
    â”‚  4. Validate file extension   â”‚
    â”‚  5. Check mode consistency    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Create Session Folder        â”‚
    â”‚ uploads/sessions/{session_id}â”‚
    â”‚         /{direction}/        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Save File to Disk            â”‚
    â”‚ file.save(filepath)          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Update Flask Session         â”‚
    â”‚ session['uploaded_files'][   â”‚
    â”‚   direction] = filepath      â”‚
    â”‚ session['processing_mode'] = â”‚
    â”‚   'video' or 'image'         â”‚
    â”‚ session.modified = True      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼ JSON Response
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ {                            â”‚
    â”‚   success: true,             â”‚
    â”‚   message: '...',            â”‚
    â”‚   direction: 'NORTH',        â”‚
    â”‚   file_type: 'image'         â”‚
    â”‚ }                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Update UI                    â”‚
    â”‚ - Show file name             â”‚
    â”‚ - Enable next upload or      â”‚
    â”‚   enable "Run Simulation"     â”‚
    â”‚   when all 4 uploaded        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Process/Analysis Flow

```
User clicks "Run Simulation"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: main.js                â”‚
â”‚ fetch('/process', {              â”‚
â”‚   method: 'POST',                â”‚
â”‚   headers: {                      â”‚
â”‚     'Content-Type': 'application/ â”‚
â”‚      json'                        â”‚
â”‚   }                              â”‚
â”‚ })                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼ HTTP POST /process
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: app.py /process endpoint    â”‚
â”‚                                      â”‚
â”‚ 1. Check session['uploaded_files']   â”‚
â”‚    - NORTH filepath âœ“               â”‚
â”‚    - SOUTH filepath âœ“               â”‚
â”‚    - EAST filepath âœ“                â”‚
â”‚    - WEST filepath âœ“                â”‚
â”‚                                      â”‚
â”‚ 2. Get processing_mode from session  â”‚
â”‚    ('video' or 'image')              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Initialize WebTrafficProcessor()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â–º For each direction (NORTH, SOUTH, EAST, WEST):
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IF mode == 'video':                        â”‚
â”‚   process_direction_video(filepath, dir)   â”‚
â”‚ ELSE:                                      â”‚
â”‚   process_direction_image(filepath, dir)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load video/image file                   â”‚
â”‚ Create VideoCapture or cv2.imread()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â–º For each frame (video) or single frame (image):
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TrafficAnalyzer.analyze_traffic()       â”‚
â”‚ Input: frame, direction                 â”‚
â”‚                                         â”‚
â”‚ 1. VehicleDetector.detect_vehicles()    â”‚
â”‚    (YOLOv11n model)                     â”‚
â”‚    â†“                                    â”‚
â”‚    Returns: List of detections          â”‚
â”‚    [{class: 2, conf: 0.95, bbox: ...},  â”‚
â”‚     {class: 3, conf: 0.87, bbox: ...},  â”‚
â”‚     ...]                                â”‚
â”‚                                         â”‚
â”‚ 2. Count vehicles by type               â”‚
â”‚    _count_vehicles_by_type(detections)  â”‚
â”‚    â†“                                    â”‚
â”‚    Returns: {                           â”‚
â”‚      'car': 5,                          â”‚
â”‚      'motorcycle': 1,                   â”‚
â”‚      'bus': 1,                          â”‚
â”‚      'truck': 0                         â”‚
â”‚    }                                    â”‚
â”‚                                         â”‚
â”‚ 3. Analyze traffic density              â”‚
â”‚    Classify: LOW / MEDIUM / HIGH /      â”‚
â”‚              CRITICAL                   â”‚
â”‚                                         â”‚
â”‚ 4. Recommend signal timing              â”‚
â”‚    Based on density & vehicle types     â”‚
â”‚    Returns: {                           â”‚
â”‚      'green_duration': 45,              â”‚
â”‚      'yellow_duration': 3,              â”‚
â”‚      'red_duration': 57                 â”‚
â”‚    }                                    â”‚
â”‚                                         â”‚
â”‚ 5. Return analysis result:              â”‚
â”‚    {                                    â”‚
â”‚      'direction': 'NORTH',              â”‚
â”‚      'vehicle_count': 7,                â”‚
â”‚      'vehicle_types': {...},            â”‚
â”‚      'density_level': 'MEDIUM',         â”‚
â”‚      'annotated_frame': frame_img,      â”‚
â”‚      'recommendations': {...}           â”‚
â”‚    }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aggregate results from all 4 directions â”‚
â”‚ aggregate_results(direction_results)    â”‚
â”‚                                         â”‚
â”‚ Returns:                                â”‚
â”‚ {                                       â”‚
â”‚   'total_vehicles': 28,                 â”‚
â”‚   'avg_density': 'MEDIUM',              â”‚
â”‚   'recommendations': {                  â”‚
â”‚     'NORTH': {timing...},               â”‚
â”‚     'SOUTH': {timing...},               â”‚
â”‚     'EAST': {timing...},                â”‚
â”‚     'WEST': {timing...},                â”‚
â”‚     'optimal_sequence': [               â”‚
â”‚       {'direction': 'EAST', ...},       â”‚
â”‚       {'direction': 'NORTH', ...},      â”‚
â”‚       {'direction': 'SOUTH', ...},      â”‚
â”‚       {'direction': 'WEST', ...}        â”‚
â”‚     ]                                   â”‚
â”‚   }                                     â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Save annotated frames to disk           â”‚
â”‚ results_folder = uploads/results/       â”‚
â”‚                  {session_id}/          â”‚
â”‚                                         â”‚
â”‚ For each direction:                     â”‚
â”‚   frame.save('direction_frame_0.jpg')   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Store in Flask Session                  â”‚
â”‚ session['results'] = {                  â”‚
â”‚   'direction_results': {...},           â”‚
â”‚   'recommendations': {...},             â”‚
â”‚   'processed_images': {...},            â”‚
â”‚   'processing_mode': 'image'            â”‚
â”‚ }                                       â”‚
â”‚ session.modified = True                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼ JSON Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                       â”‚
â”‚   'success': true,                      â”‚
â”‚   'redirect': '/results',               â”‚
â”‚   'session_id': '...'                   â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼ Frontend redirects
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ window.location.href = '/results'       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /results endpoint                   â”‚
â”‚ Render results.html                     â”‚
â”‚ Pass session data to template           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Display Results Page with:              â”‚
â”‚ - Annotated traffic images              â”‚
â”‚ - Vehicle type breakdown (emojis)       â”‚
â”‚ - Recommended signal timings            â”‚
â”‚ - Optimal signal sequence               â”‚
â”‚ - Live signal simulation                â”‚
â”‚ - AI Chatbot interface                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## User Interaction Flow

### Complete User Journey

```
START
  â”‚
  â–¼ (First visit)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Landing Page (/)      â”‚
â”‚ - Welcome message     â”‚
â”‚ - Feature overview    â”‚
â”‚ - Start button        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼ Click "Start"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Traffic Page (/traffic)
â”‚ - Upload interface    â”‚
â”‚ - 4 direction zones   â”‚
â”‚ - Drag & drop areas   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Upload Phase            â”‚
          â”‚                         â”‚
          â–¼                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚ Upload NORTHâ”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
           â”‚ File saved            â”‚
           â”‚ Session updated       â”‚
           â–¼                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚Upload SOUTH  â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
           â”‚ File saved            â”‚
           â”‚ Session updated       â”‚
           â–¼                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚ Upload EAST  â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
           â”‚ File saved            â”‚
           â”‚ Session updated       â”‚
           â–¼                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚ Upload WEST  â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
           â”‚ File saved            â”‚
           â”‚ Session updated       â”‚
           â”‚ Enable "Run" button   â”‚
           â”‚                       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
          â–¼ Click "Run Simulation"
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Processing Phase    â”‚
    â”‚ (Loading...)        â”‚
    â”‚ - Analyzing videos  â”‚
    â”‚ - Detecting traffic â”‚
    â”‚ - Computing timing  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼ (5-30 seconds)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Results Page (/results)
    â”‚                      â”‚
    â”‚ Section 1: Summary   â”‚
    â”‚ - Mode: IMAGE/VIDEO  â”‚
    â”‚ - 4 directions OK    â”‚
    â”‚                      â”‚
    â”‚ Section 2: Sequence  â”‚
    â”‚ - EAST (60s green)   â”‚
    â”‚ - NORTH (45s green)  â”‚
    â”‚ - SOUTH (30s green)  â”‚
    â”‚ - WEST (15s green)   â”‚
    â”‚                      â”‚
    â”‚ Section 3: Analysis  â”‚
    â”‚ - Images with boxes  â”‚
    â”‚ - Vehicle counts     â”‚
    â”‚ - Type breakdown     â”‚
    â”‚   ğŸš— 6 cars          â”‚
    â”‚   ğŸï¸ 1 motorcycle    â”‚
    â”‚   ğŸšŒ 1 bus           â”‚
    â”‚   ğŸšš 0 trucks        â”‚
    â”‚                      â”‚
    â”‚ Section 4: Simulator â”‚
    â”‚ - Live animation     â”‚
    â”‚ - Signal timing      â”‚
    â”‚ - Traffic flow       â”‚
    â”‚                      â”‚
    â”‚ Section 5: Chatbot   â”‚
    â”‚ - Message input      â”‚
    â”‚ - Chat history       â”‚
    â”‚ - AI responses       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”œâ”€â–º Ask Chatbot Questions
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ User: "What's the    â”‚
    â”‚ traffic situation?"  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼ HTTP POST /chat
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Backend: Chatbot Handler     â”‚
    â”‚                              â”‚
    â”‚ 1. Extract user message      â”‚
    â”‚ 2. Get traffic data from     â”‚
    â”‚    session['results']        â”‚
    â”‚ 3. Build context:            â”‚
    â”‚    NORTH: 7 vehicles, ...    â”‚
    â”‚    SOUTH: 5 vehicles, ...    â”‚
    â”‚    EAST: 15 vehicles, ...    â”‚
    â”‚    WEST: 3 vehicles, ...     â”‚
    â”‚ 4. Create system prompt      â”‚
    â”‚ 5. Call Gemini API           â”‚
    â”‚    genai.generate_content()  â”‚
    â”‚ 6. Return AI response        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼ JSON Response
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ {                            â”‚
    â”‚   success: true,             â”‚
    â”‚   response: "Based on the    â”‚
    â”‚   current analysis, EAST     â”‚
    â”‚   is experiencing CRITICAL   â”‚
    â”‚   congestion with 15         â”‚
    â”‚   vehicles..."               â”‚
    â”‚ }                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼ Update Chat UI
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Display AI response          â”‚
    â”‚ - Add to message history     â”‚
    â”‚ - Scroll to latest message   â”‚
    â”‚ - Enable new input           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â–º Ask more questions or
               â”‚   Reset & Upload New Data
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Reset Button (/reset)        â”‚
    â”‚ - Clear session              â”‚
    â”‚ - Remove files from disk     â”‚
    â”‚ - Return to /traffic page    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Upload new files             â”‚
    â”‚ (Cycle repeats)              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

END
```

---

## Traffic Analysis Flow

### Detailed ML Pipeline

```
Input: Video/Image File
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frame Extraction             â”‚
â”‚ - Video: Extract frames      â”‚
â”‚   (every N frames)           â”‚
â”‚ - Image: Single frame        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â–º Frame 1, Frame 2, ..., Frame N
           â”‚
           â–¼ For each frame:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ YOLOv11n Object Detection    â”‚
â”‚                              â”‚
â”‚ Input: Video frame (640x480) â”‚
â”‚                              â”‚
â”‚ Model: yolo11n.pt            â”‚
â”‚ Classes:                     â”‚
â”‚   0 = person                 â”‚
â”‚   1 = car                    â”‚
â”‚   2 = car (detection)        â”‚
â”‚   3 = motorcycle             â”‚
â”‚   5 = bus                    â”‚
â”‚   7 = truck                  â”‚
â”‚                              â”‚
â”‚ Output: Detections           â”‚
â”‚ [                            â”‚
â”‚   {                          â”‚
â”‚     class: 2,                â”‚
â”‚     class_name: 'car',       â”‚
â”‚     confidence: 0.95,        â”‚
â”‚     bbox: [x1,y1,x2,y2],     â”‚
â”‚     area: pixels             â”‚
â”‚   },                         â”‚
â”‚   {                          â”‚
â”‚     class: 3,                â”‚
â”‚     class_name: 'motorcycle',â”‚
â”‚     confidence: 0.87,        â”‚
â”‚     bbox: [...],             â”‚
â”‚     area: pixels             â”‚
â”‚   },                         â”‚
â”‚   ...                        â”‚
â”‚ ]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vehicle Type Counting        â”‚
â”‚                              â”‚
â”‚ _count_vehicles_by_type()    â”‚
â”‚                              â”‚
â”‚ Iterate through detections:  â”‚
â”‚   if class == 2: car_count++ â”‚
â”‚   if class == 3: moto_count++â”‚
â”‚   if class == 5: bus_count++ â”‚
â”‚   if class == 7: truck_count++
â”‚                              â”‚
â”‚ Output: {                    â”‚
â”‚   'car': 5,                  â”‚
â”‚   'motorcycle': 1,           â”‚
â”‚   'bus': 1,                  â”‚
â”‚   'truck': 0,                â”‚
â”‚   'total': 7                 â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Density Classification       â”‚
â”‚                              â”‚
â”‚ Based on vehicle count:      â”‚
â”‚   0-5: LOW                   â”‚
â”‚   6-10: MEDIUM               â”‚
â”‚   11-20: HIGH                â”‚
â”‚   21+: CRITICAL              â”‚
â”‚                              â”‚
â”‚ Output: Density Level String â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Signal Timing Recommendation â”‚
â”‚                              â”‚
â”‚ Based on Density:            â”‚
â”‚   LOW:      30s green        â”‚
â”‚   MEDIUM:   45s green        â”‚
â”‚   HIGH:     60s green        â”‚
â”‚   CRITICAL: 90s green        â”‚
â”‚                              â”‚
â”‚ Yellow: 3s (always)          â”‚
â”‚ Red:    (Total cycle - green)
â”‚                              â”‚
â”‚ Output: {                    â”‚
â”‚   'green_duration': 45,      â”‚
â”‚   'yellow_duration': 3,      â”‚
â”‚   'red_duration': 57         â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frame Annotation             â”‚
â”‚                              â”‚
â”‚ Draw on frame:               â”‚
â”‚ - Bounding boxes (by type)   â”‚
â”‚   ğŸš— Green box               â”‚
â”‚   ğŸï¸ Blue box                â”‚
â”‚   ğŸšŒ Orange box              â”‚
â”‚   ğŸšš Purple box              â”‚
â”‚ - Vehicle count text         â”‚
â”‚ - Direction label            â”‚
â”‚ - Density indicator          â”‚
â”‚                              â”‚
â”‚ Output: Annotated frame img  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼ Repeat for all frames
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aggregate All Frames         â”‚
â”‚ (Video mode):                â”‚
â”‚                              â”‚
â”‚ Average vehicle counts:      â”‚
â”‚ - Count vehicles per frame   â”‚
â”‚ - Sum totals                 â”‚
â”‚ - Calculate averages         â”‚
â”‚ - Find peak values           â”‚
â”‚                              â”‚
â”‚ Output: {                    â”‚
â”‚   'average_vehicles': 7.5,   â”‚
â”‚   'max_vehicles': 12,        â”‚
â”‚   'vehicle_types': {         â”‚
â”‚     'car': 5,                â”‚
â”‚     'motorcycle': 1,         â”‚
â”‚     'bus': 1,                â”‚
â”‚     'truck': 0               â”‚
â”‚   },                         â”‚
â”‚   'sample_frames': [frame0,  â”‚
â”‚                    frame1,   â”‚
â”‚                    ...]      â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼ Per direction result
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Direction Result:            â”‚
â”‚ {                            â”‚
â”‚   'direction': 'NORTH',      â”‚
â”‚   'vehicle_count': 7,        â”‚
â”‚   'average_vehicles': 7.2,   â”‚
â”‚   'max_vehicles': 12,        â”‚
â”‚   'vehicle_types': {         â”‚
â”‚     'car': 5,                â”‚
â”‚     'motorcycle': 1,         â”‚
â”‚     'bus': 1,                â”‚
â”‚     'truck': 0               â”‚
â”‚   },                         â”‚
â”‚   'density_level': 'MEDIUM', â”‚
â”‚   'annotated_frame': img,    â”‚
â”‚   'recommendations': {       â”‚
â”‚     'green_duration': 45,    â”‚
â”‚     'yellow_duration': 3,    â”‚
â”‚     'red_duration': 57       â”‚
â”‚   }                          â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚            â”‚            â”‚
    â–¼             â–¼            â–¼            â–¼
 NORTH         SOUTH         EAST         WEST
   7 veh        5 veh         15 veh       3 veh
   MED          LOW           HIGH         LOW
   45s gr        30s gr        60s gr       15s gr
```

---

## Chatbot Integration Flow

### AI-Powered Traffic Q&A System

```
User Types Question in Chatbot
"What's the current traffic situation?"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: chatbot.js       â”‚
â”‚ TrafficChatbot.sendMessage()
â”‚                            â”‚
â”‚ 1. Get input value         â”‚
â”‚ 2. Trim whitespace         â”‚
â”‚ 3. Display user message    â”‚
â”‚    in chat history         â”‚
â”‚ 4. Clear input field       â”‚
â”‚ 5. Show loading indicator  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ HTTP POST /chat
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Backend: app.py /chat endpoint   â”‚
    â”‚                                  â”‚
    â”‚ 1. Extract JSON:                 â”‚
    â”‚    { message: "What's..." }      â”‚
    â”‚                                  â”‚
    â”‚ 2. Get traffic data from session:â”‚
    â”‚    session['results'] = {        â”‚
    â”‚      direction_results: {        â”‚
    â”‚        'NORTH': {                â”‚
    â”‚          'vehicle_count': 7,     â”‚
    â”‚          'vehicle_types': {...}, â”‚
    â”‚          'density_level': 'MED'  â”‚
    â”‚        },                        â”‚
    â”‚        'SOUTH': {...},           â”‚
    â”‚        'EAST': {...},            â”‚
    â”‚        'WEST': {...}             â”‚
    â”‚      },                          â”‚
    â”‚      recommendations: {...}      â”‚
    â”‚    }                             â”‚
    â”‚                                  â”‚
    â”‚ 3. Build context with function: â”‚
    â”‚    _build_traffic_context()      â”‚
    â”‚                                  â”‚
    â”‚    Context string created:       â”‚
    â”‚    "NORTH: Density=MEDIUM,       â”‚
    â”‚     Vehicles=Avg:7, Peak:12,     â”‚
    â”‚     Types=[car:5, moto:1,        â”‚
    â”‚     bus:1, truck:0],             â”‚
    â”‚     Green=45s, Yellow=3s         â”‚
    â”‚     ...similar for other dirs"   â”‚
    â”‚                                  â”‚
    â”‚ 4. Create system prompt:         â”‚
    â”‚    system_prompt = f"""          â”‚
    â”‚    You are a traffic assistant.  â”‚
    â”‚    You have access to real-time  â”‚
    â”‚    traffic analysis data from a  â”‚
    â”‚    4-way intersection.           â”‚
    â”‚                                  â”‚
    â”‚    CURRENT TRAFFIC DATA:         â”‚
    â”‚    {context}                     â”‚
    â”‚                                  â”‚
    â”‚    Guidelines:                   â”‚
    â”‚    - Provide concise answers     â”‚
    â”‚    - Suggest signal adjustments  â”‚
    â”‚    - Answer about directions    â”‚
    â”‚    - Use provided data          â”‚
    â”‚    """                           â”‚
    â”‚                                  â”‚
    â”‚ 5. Import Google Gemini:         â”‚
    â”‚    import google.generativeai    â”‚
    â”‚    as genai                      â”‚
    â”‚                                  â”‚
    â”‚ 6. Configure API:                â”‚
    â”‚    genai.configure(              â”‚
    â”‚      api_key=os.environ.get(     â”‚
    â”‚        'GEMINI_API_KEY'          â”‚
    â”‚      )                           â”‚
    â”‚    )                             â”‚
    â”‚                                  â”‚
    â”‚ 7. Create model instance:        â”‚
    â”‚    model = genai.                â”‚
    â”‚    GenerativeModel(              â”‚
    â”‚      'gemini-pro'                â”‚
    â”‚    )                             â”‚
    â”‚                                  â”‚
    â”‚ 8. Generate response:            â”‚
    â”‚    response = model.             â”‚
    â”‚    generate_content(             â”‚
    â”‚      system_prompt +             â”‚
    â”‚      "\nUser: " + user_message,  â”‚
    â”‚      generation_config={         â”‚
    â”‚        max_output_tokens: 500,   â”‚
    â”‚        temperature: 0.7           â”‚
    â”‚      }                           â”‚
    â”‚    )                             â”‚
    â”‚                                  â”‚
    â”‚ 9. Extract text:                 â”‚
    â”‚    bot_response = response.text  â”‚
    â”‚                                  â”‚
    â”‚    Example response:             â”‚
    â”‚    "Based on current analysis:   â”‚
    â”‚     EAST direction is the most   â”‚
    â”‚     congested with 15 vehicles   â”‚
    â”‚     (HIGH density). I recommend  â”‚
    â”‚     extending green signal to    â”‚
    â”‚     60 seconds. NORTH has MEDIUM â”‚
    â”‚     density with 7 vehicles...   â”‚
    â”‚     Recommended sequence: EAST   â”‚
    â”‚     (60s) â†’ NORTH (45s) â†’        â”‚
    â”‚     SOUTH (30s) â†’ WEST (15s)"    â”‚
    â”‚                                  â”‚
    â”‚ 10. Handle errors:               â”‚
    â”‚     try/except for API calls     â”‚
    â”‚     Return error message if      â”‚
    â”‚     API fails or key invalid     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼ JSON Response
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ {                                â”‚
    â”‚   success: true,                 â”‚
    â”‚   response: "Based on current... â”‚
    â”‚   ...",                          â”‚
    â”‚   timestamp: "2026-01-27..."     â”‚
    â”‚ }                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼ Frontend receives
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ chatbot.js: getAIResponse()       â”‚
    â”‚                                  â”‚
    â”‚ 1. Parse JSON response           â”‚
    â”‚ 2. Hide loading indicator        â”‚
    â”‚ 3. Call addMessage(response,     â”‚
    â”‚    'bot')                        â”‚
    â”‚ 4. Display in chat history       â”‚
    â”‚ 5. Scroll to latest message      â”‚
    â”‚ 6. Enable input field            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Chat UI Updated                  â”‚
    â”‚                                  â”‚
    â”‚ User: "What's the current..."   â”‚
    â”‚                                  â”‚
    â”‚ Bot:  "Based on current          â”‚
    â”‚        analysis: EAST is the     â”‚
    â”‚        most congested..."        â”‚
    â”‚                                  â”‚
    â”‚ Ready for next question â†“        â”‚
    â”‚ [Input field enabled]            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Structure & Dependencies

### Project Tree with Relationships

```
ai-traffic-management/
â”‚
â”œâ”€â”€ Core Application
â”‚   â”œâ”€â”€ app.py .......................... Flask main app (508 lines)
â”‚   â”‚   â”œâ”€ Imports: Flask, session, jsonify
â”‚   â”‚   â”œâ”€ Routes:
â”‚   â”‚   â”‚  â”œâ”€ GET / (landing)
â”‚   â”‚   â”‚  â”œâ”€ GET /traffic (upload)
â”‚   â”‚   â”‚  â”œâ”€ GET /results (analysis)
â”‚   â”‚   â”‚  â”œâ”€ POST /upload (file handler)
â”‚   â”‚   â”‚  â”œâ”€ POST /process (analysis runner)
â”‚   â”‚   â”‚  â”œâ”€ POST /chat (chatbot)
â”‚   â”‚   â”‚  â”œâ”€ GET /api/session-test (debug)
â”‚   â”‚   â”‚  â””â”€ POST /reset (cleanup)
â”‚   â”‚   â”œâ”€ Uses: web_processor, session management
â”‚   â”‚   â””â”€ Integrates: Google Gemini API
â”‚   â”‚
â”‚   â””â”€â”€ web_processor.py ............... Traffic processor (300+ lines)
â”‚       â”œâ”€ Class: WebTrafficProcessor
â”‚       â”œâ”€ Methods:
â”‚       â”‚  â”œâ”€ process_direction_video()
â”‚       â”‚  â”œâ”€ process_direction_image()
â”‚       â”‚  â”œâ”€ aggregate_results()
â”‚       â”‚  â””â”€ save_annotated_frame()
â”‚       â”œâ”€ Imports: cv2, ultralytics, numpy
â”‚       â””â”€ Uses: src/traffic_analyzer, src/vehicle_detector
â”‚
â”œâ”€â”€ ML & Analysis (src/)
â”‚   â”œâ”€â”€ __init__.py ..................... Package marker
â”‚   â”‚
â”‚   â”œâ”€â”€ config.py ....................... Configuration constants
â”‚   â”‚   â”œâ”€ VEHICLE_CLASSES = {
â”‚   â”‚   â”‚    2: 'car',
â”‚   â”‚   â”‚    3: 'motorcycle',
â”‚   â”‚   â”‚    5: 'bus',
â”‚   â”‚   â”‚    7: 'truck'
â”‚   â”‚   â”‚  }
â”‚   â”‚   â”œâ”€ VEHICLE_COLORS (RGB tuples)
â”‚   â”‚   â”œâ”€ TRAFFIC_ZONES
â”‚   â”‚   â””â”€ Signal timing ranges
â”‚   â”‚
â”‚   â”œâ”€â”€ vehicle_detector.py ............ YOLOv11n wrapper (150+ lines)
â”‚   â”‚   â”œâ”€ Class: VehicleDetector
â”‚   â”‚   â”œâ”€ Methods:
â”‚   â”‚   â”‚  â”œâ”€ __init__() - Load model
â”‚   â”‚   â”‚  â””â”€ detect_vehicles(frame)
â”‚   â”‚   â”œâ”€ Model: yolo11n.pt (COCO dataset)
â”‚   â”‚   â””â”€ Output: List of detections
â”‚   â”‚
â”‚   â”œâ”€â”€ traffic_analyzer.py ............ Traffic analysis (250+ lines)
â”‚   â”‚   â”œâ”€ Class: TrafficAnalyzer
â”‚   â”‚   â”œâ”€ Methods:
â”‚   â”‚   â”‚  â”œâ”€ analyze_traffic(frame, dir)
â”‚   â”‚   â”‚  â”œâ”€ detect_vehicles()
â”‚   â”‚   â”‚  â”œâ”€ _count_vehicles_by_type()
â”‚   â”‚   â”‚  â”œâ”€ recommend_signal_timing()
â”‚   â”‚   â”‚  â””â”€ classify_density()
â”‚   â”‚   â””â”€ Uses: vehicle_detector, config
â”‚   â”‚
â”‚   â”œâ”€â”€ visualizer.py ................... Visualization (150+ lines)
â”‚   â”‚   â”œâ”€ Class: TrafficVisualizer
â”‚   â”‚   â”œâ”€ Methods:
â”‚   â”‚   â”‚  â”œâ”€ draw_detections_and_zones()
â”‚   â”‚   â”‚  â”œâ”€ draw_signal_state()
â”‚   â”‚   â”‚  â””â”€ draw_density_indicator()
â”‚   â”‚   â””â”€ Uses: config for colors
â”‚   â”‚
â”‚   â””â”€â”€ signal_controller.py ........... Signal logic (100+ lines)
â”‚       â”œâ”€ Class: SignalController
â”‚       â”œâ”€ Methods:
â”‚       â”‚  â”œâ”€ adjust_timing()
â”‚       â”‚  â”œâ”€ get_optimal_sequence()
â”‚       â”‚  â””â”€ calculate_cycle_time()
â”‚       â””â”€ Uses: traffic_analyzer results
â”‚
â”œâ”€â”€ Frontend (templates/)
â”‚   â”œâ”€â”€ landing.html ................... Entry page (150+ lines)
â”‚   â”‚   â”œâ”€ Logo & welcome message
â”‚   â”‚   â”œâ”€ Feature overview
â”‚   â”‚   â””â”€ Start button
â”‚   â”‚
â”‚   â”œâ”€â”€ index.html ..................... Upload interface (160+ lines)
â”‚   â”‚   â”œâ”€ 4-way intersection display
â”‚   â”‚   â”œâ”€ Drag & drop zones
â”‚   â”‚   â”œâ”€ Progress indicators
â”‚   â”‚   â””â”€ "Run Simulation" button
â”‚   â”‚   â””â”€ Loaded by: main.js
â”‚   â”‚
â”‚   â”œâ”€â”€ results.html ................... Results dashboard (514+ lines)
â”‚   â”‚   â”œâ”€ Summary section
â”‚   â”‚   â”œâ”€ Annotated images
â”‚   â”‚   â”œâ”€ Vehicle breakdown cards
â”‚   â”‚   â”œâ”€ Optimal sequence display
â”‚   â”‚   â”œâ”€ Traffic simulator (canvas)
â”‚   â”‚   â”œâ”€ Chatbot interface
â”‚   â”‚   â””â”€ Loaded by: chatbot.js
â”‚   â”‚
â”‚   â””â”€â”€ accident.html .................. Accident detection page
â”‚       â””â”€ (Optional feature)
â”‚
â”œâ”€â”€ Frontend JS (static/js/)
â”‚   â”œâ”€â”€ main.js ........................ Upload logic (436 lines)
â”‚   â”‚   â”œâ”€ Drag & drop handler
â”‚   â”‚   â”œâ”€ File upload POST /upload
â”‚   â”‚   â”œâ”€ Bulk upload support
â”‚   â”‚   â”œâ”€ Direction assignment
â”‚   â”‚   â”œâ”€ Process trigger (POST /process)
â”‚   â”‚   â”œâ”€ Error handling & UI updates
â”‚   â”‚   â””â”€ Session tracking
â”‚   â”‚
â”‚   â””â”€â”€ chatbot.js ..................... Chat interface (181 lines)
â”‚       â”œâ”€ Class: TrafficChatbot
â”‚       â”œâ”€ Methods:
â”‚       â”‚  â”œâ”€ init() - Setup listeners
â”‚       â”‚  â”œâ”€ sendMessage() - Handle input
â”‚       â”‚  â”œâ”€ getAIResponse() - Call /chat
â”‚       â”‚  â”œâ”€ addMessage() - Display msg
â”‚       â”‚  â””â”€ toggleChatbot() - Show/hide
â”‚       â”œâ”€ Event handlers
â”‚       â””â”€ Uses: Fetch API for /chat
â”‚
â”œâ”€â”€ Styling (static/css/)
â”‚   â””â”€â”€ style.css ....................... Complete styling (1858 lines)
â”‚       â”œâ”€ CSS variables (colors, sizes)
â”‚       â”œâ”€ Layout styles
â”‚       â”œâ”€ Component styles
â”‚       â”œâ”€ Chatbot styles (220+ lines)
â”‚       â”œâ”€ Traffic simulator styles
â”‚       â”œâ”€ Responsive design
â”‚       â”œâ”€ Animations
â”‚       â””â”€ No gradients (solid colors)
â”‚
â”œâ”€â”€ Data & Models
â”‚   â”œâ”€â”€ yolo11n.pt ..................... YOLOv11 nano model (~25MB)
â”‚   â”‚   â”œâ”€ COCO pre-trained weights
â”‚   â”‚   â”œâ”€ 80 classes (cars, motorcycles, etc)
â”‚   â”‚   â””â”€ CPU-optimized (nano version)
â”‚   â”‚
â”‚   â””â”€â”€ uploads/ ....................... Runtime data
â”‚       â”œâ”€ sessions/ ................... Per-session folders
â”‚       â”‚  â””â”€ {session_id}/
â”‚       â”‚     â”œâ”€ north/
â”‚       â”‚     â”œâ”€ south/
â”‚       â”‚     â”œâ”€ east/
â”‚       â”‚     â””â”€ west/
â”‚       â””â”€ results/ .................... Analysis outputs
â”‚          â””â”€ {session_id}/
â”‚             â”œâ”€ north_frame_0.jpg
â”‚             â”œâ”€ south_frame_0.jpg
â”‚             â””â”€ ...
â”‚
â”œâ”€â”€ Configuration
â”‚   â”œâ”€â”€ .env ............................ Environment variables (LOCAL)
â”‚   â”‚   â”œâ”€ GEMINI_API_KEY=...
â”‚   â”‚   â”œâ”€ FLASK_ENV=development
â”‚   â”‚   â”œâ”€ SECRET_KEY=...
â”‚   â”‚   â””â”€ PORT=5000
â”‚   â”‚
â”‚   â”œâ”€â”€ .env.example ................... Template (no secrets)
â”‚   â”‚
â”‚   â”œâ”€â”€ requirements.txt ............... Python dependencies
â”‚   â”‚   â”œâ”€ ultralytics==8.0.0 (YOLO)
â”‚   â”‚   â”œâ”€ opencv-python-headless==4.8.0 (CV)
â”‚   â”‚   â”œâ”€ flask==3.0.0 (Web)
â”‚   â”‚   â”œâ”€ google-generativeai>=0.3.0 (Gemini)
â”‚   â”‚   â”œâ”€ numpy, pandas, pillow (Utils)
â”‚   â”‚   â””â”€ gunicorn (Production server)
â”‚   â”‚
â”‚   â”œâ”€â”€ runtime.txt .................... Python version
â”‚   â”‚   â””â”€ python-3.10.13
â”‚   â”‚
â”‚   â”œâ”€â”€ Procfile ........................ Heroku deployment
â”‚   â”‚   â””â”€ web: gunicorn app:app
â”‚   â”‚
â”‚   â””â”€â”€ render.yaml .................... Render deployment
â”‚       â””â”€ Services config
â”‚
â”œâ”€â”€ Documentation
â”‚   â””â”€â”€ README.md ....................... Project guide
â”‚       â”œâ”€ Features
â”‚       â”œâ”€ Setup instructions
â”‚       â”œâ”€ Usage guide
â”‚       â””â”€ Deployment info
â”‚
â””â”€â”€ Git
    â”œâ”€â”€ .git/ ........................... Version control
    â”œâ”€â”€ .gitignore ....................... Exclude files
    â”‚   â”œâ”€ __pycache__
    â”‚   â”œâ”€ .env (secrets)
    â”‚   â”œâ”€ *.pyc
    â”‚   â””â”€ uploads/ (temp data)
    â””â”€â”€ LICENSE .......................... MIT License
```

---

## Database/Session Flow

### Flask Session Management

```
CLIENT SIDE (Browser Cookies)
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ First Request to /traffic        â”‚
        â”‚                                  â”‚
        â–¼                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GET /traffic    â”‚          â”‚ Server Response      â”‚
    â”‚                 â”‚          â”‚                      â”‚
    â”‚ Cookie header:  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Set-Cookie: session â”‚
    â”‚ (empty)         â”‚          â”‚ =abc123def456gh...   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Browser Stores Cookie       â”‚
    â”‚ Name: session               â”‚
    â”‚ Value: abc123def456gh...    â”‚
    â”‚ Path: /                     â”‚
    â”‚ HttpOnly: true              â”‚
    â”‚ SameSite: Lax               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SERVER SIDE (Flask Session Storage)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flask Session Configuration (app.py)       â”‚
â”‚                                            â”‚
â”‚ app.secret_key = os.environ.get(          â”‚
â”‚   'SECRET_KEY',                            â”‚
â”‚   'dev-secret-key...'                      â”‚
â”‚ )                                          â”‚
â”‚                                            â”‚
â”‚ app.config['SESSION_TYPE'] =               â”‚
â”‚   'filesystem'                             â”‚
â”‚                                            â”‚
â”‚ app.config['PERMANENT_SESSION_LIFETIME'] =â”‚
â”‚   3600  # 1 hour                           â”‚
â”‚                                            â”‚
â”‚ app.config['SESSION_COOKIE_HTTPONLY'] =   â”‚
â”‚   True                                     â”‚
â”‚                                            â”‚
â”‚ app.config['SESSION_COOKIE_SAMESITE'] =   â”‚
â”‚   'Lax'                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼


UPLOAD FLOW - Session Data Population
        â”‚
        â”œâ”€â–º POST /upload (NORTH file)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request arrives with:               â”‚
â”‚ - Cookie: session=abc123...         â”‚
â”‚ - Form: direction='NORTH'           â”‚
â”‚ - Files: file=<binary>              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flask reads cookie                  â”‚
â”‚ Decrypts using SECRET_KEY            â”‚
â”‚ Loads session data from disk        â”‚
â”‚ (if exists)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Handler: /upload                    â”‚
â”‚                                     â”‚
â”‚ session['uploaded_files'] = {}      â”‚
â”‚ session['uploaded_files']['NORTH']  â”‚
â”‚   = 'uploads/sessions/x/north/...'  â”‚
â”‚ session['processing_mode'] = 'image'â”‚
â”‚ session.modified = True             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flask encrypts session with         â”‚
â”‚ SECRET_KEY and saves to disk:       â”‚
â”‚ flask_session/abc123def456gh...     â”‚
â”‚ (contains all session data)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response sent to client:            â”‚
â”‚ {success: true, ...}                â”‚
â”‚ Set-Cookie: session=abc123...       â”‚
â”‚ (same cookie)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PROCESS FLOW - Session Data Reading
        â”‚
        â”œâ”€â–º POST /process
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request arrives with:               â”‚
â”‚ - Cookie: session=abc123...         â”‚
â”‚ - Body: {} (empty JSON)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flask reads cookie                  â”‚
â”‚ Decrypts using SECRET_KEY            â”‚
â”‚ Loads session from disk             â”‚
â”‚ flask_session/abc123def456gh...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Handler: /process                   â”‚
â”‚                                     â”‚
â”‚ session['uploaded_files'] = {       â”‚
â”‚   'NORTH': 'path/north/file.jpg',   â”‚
â”‚   'SOUTH': 'path/south/file.jpg',   â”‚
â”‚   'EAST': 'path/east/file.jpg',     â”‚
â”‚   'WEST': 'path/west/file.jpg'      â”‚
â”‚ }                                   â”‚
â”‚                                     â”‚
â”‚ Read all 4 files from disk          â”‚
â”‚ Process each one                    â”‚
â”‚ Store results in session['results'] â”‚
â”‚ session.modified = True             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flask encrypts updated session      â”‚
â”‚ with SECRET_KEY and saves:          â”‚
â”‚ flask_session/abc123def456gh...     â”‚
â”‚ (now contains uploaded_files +      â”‚
â”‚  results)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


SESSION DATA STRUCTURE

Session Object (dictionary):
{
  'session_id': '550e8400-e29b-41d4-a716-446655440000',
  
  'uploaded_files': {
    'NORTH': 'uploads/sessions/550e8400.../north/traffic_north.jpg',
    'SOUTH': 'uploads/sessions/550e8400.../south/traffic_south.jpg',
    'EAST': 'uploads/sessions/550e8400.../east/traffic_east.jpg',
    'WEST': 'uploads/sessions/550e8400.../west/traffic_west.jpg'
  },
  
  'processing_mode': 'image',  # or 'video'
  
  'results': {
    'direction_results': {
      'NORTH': {
        'direction': 'NORTH',
        'vehicle_count': 7,
        'average_vehicles': 7.2,
        'max_vehicles': 12,
        'vehicle_types': {
          'car': 5,
          'motorcycle': 1,
          'bus': 1,
          'truck': 0
        },
        'density_level': 'MEDIUM',
        'annotated_frame': <ndarray>,
        'recommendations': {
          'green_duration': 45,
          'yellow_duration': 3,
          'red_duration': 57,
          'density_level': 'MEDIUM'
        }
      },
      'SOUTH': { ... },
      'EAST': { ... },
      'WEST': { ... }
    },
    
    'recommendations': {
      'NORTH': {
        'green_duration': 45,
        'yellow_duration': 3,
        'red_duration': 57,
        'density_level': 'MEDIUM'
      },
      'SOUTH': { ... },
      'EAST': { ... },
      'WEST': { ... },
      
      'optimal_sequence': [
        {
          'direction': 'EAST',
          'order': 1,
          'green_duration': 60,
          'yellow_duration': 3,
          'red_duration': 57
        },
        { 'direction': 'NORTH', 'order': 2, ... },
        { 'direction': 'SOUTH', 'order': 3, ... },
        { 'direction': 'WEST', 'order': 4, ... }
      ]
    },
    
    'processing_mode': 'image',
    'processed_images': {
      'NORTH': 'uploads/results/550e8400.../north_annotated.jpg',
      'SOUTH': 'uploads/results/550e8400.../south_annotated.jpg',
      'EAST': 'uploads/results/550e8400.../east_annotated.jpg',
      'WEST': 'uploads/results/550e8400.../west_annotated.jpg'
    }
  }
}

Disk Storage:
  flask_session/
    â””â”€ abc123def456gh... (encrypted session data file)
    â””â”€ xyz789uvw123... (another user's session)
    â””â”€ ...

File System:
  uploads/
    sessions/
      550e8400.../
        north/
          â””â”€ traffic_north.jpg (original)
        south/
          â””â”€ traffic_south.jpg
        east/
          â””â”€ traffic_east.jpg
        west/
          â””â”€ traffic_west.jpg
    
    results/
      550e8400.../
        â”œâ”€ north_annotated.jpg (with boxes)
        â”œâ”€ south_annotated.jpg
        â”œâ”€ east_annotated.jpg
        â””â”€ west_annotated.jpg
```

---

## Summary: Complete Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER JOURNEY                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 1: LANDING
  Landing Page (/)
  â†“ Click Start
  
STEP 2: UPLOAD
  Index/Upload Page (/traffic)
  Upload 4 images (NORTH, SOUTH, EAST, WEST)
  â†’ POST /upload (4x)
  â†’ Files saved to disk
  â†’ Session updated with file paths
  
STEP 3: PROCESS
  Click "Run Simulation"
  â†’ POST /process
  â†’ Flask reads session to get file paths
  â†’ For each direction:
     â”œâ”€ Load image from disk
     â”œâ”€ Run YOLOv11n detection
     â”œâ”€ Count vehicles by type
     â”œâ”€ Classify density
     â”œâ”€ Recommend signal timing
     â””â”€ Annotate image
  â†’ Aggregate results from all 4 directions
  â†’ Store results in session
  â†’ Redirect to /results
  
STEP 4: DISPLAY RESULTS
  Results Page (/results)
  â”œâ”€ Summary section
  â”œâ”€ Annotated traffic images
  â”œâ”€ Vehicle breakdown (ğŸš— ğŸï¸ ğŸšŒ ğŸšš)
  â”œâ”€ Optimal signal sequence
  â”œâ”€ Traffic simulator animation
  â””â”€ Chatbot interface
  
STEP 5: CHAT WITH AI
  User asks: "What's the traffic situation?"
  â†’ POST /chat { message: "..." }
  â†’ Backend builds traffic context from session['results']
  â†’ Calls Google Gemini API with context
  â†’ Gemini returns intelligent response
  â†’ Response displayed in chat
  â†’ User can ask follow-up questions
  
STEP 6: RESET
  Click Reset â†’ POST /reset
  â†’ Clear session
  â†’ Delete temporary files
  â†’ Return to /traffic
  â†’ Repeat from STEP 2

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       KEY INTEGRATIONS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. YOLO Integration
   YOLOv11n Model â†’ detect_vehicles() â†’ List of detections
   Input: Video frame (640x480)
   Output: [{class, confidence, bbox}, ...]
   
2. Flask Sessions
   Persist data across requests
   Encrypted with SECRET_KEY
   Stored in flask_session/ directory
   
3. Gemini AI Integration
   Traffic context â†’ genai.GenerativeModel('gemini-pro')
   Input: System prompt + traffic data
   Output: Natural language response
   
4. File System
   uploads/sessions/{id}/ â†’ Uploaded files
   uploads/results/{id}/  â†’ Processed frames
   yolo11n.pt â†’ ML model
   
5. Frontend Framework
   HTML (templates) + CSS (style.css)
   JavaScript (main.js, chatbot.js)
   Fetch API for async HTTP calls
```

---

## Quick Reference: What Happens When

| Action | Endpoint | Process | Output |
|--------|----------|---------|--------|
| User visits | GET / | Render landing.html | Welcome page |
| Click Start | GET /traffic | Reset session, render index.html | Upload interface |
| Upload file | POST /upload | Save to disk, update session | Success response |
| Run Analysis | POST /process | Load files, detect, aggregate | Redirect to /results |
| View Results | GET /results | Read session, render results.html | Analysis dashboard |
| Ask AI | POST /chat | Build context, call Gemini | AI response |
| Reset | POST /reset | Clear session, delete files | Redirect to /traffic |

---

This document provides a complete visual representation of your entire project. All data flows, integrations, and interactions are mapped out!
